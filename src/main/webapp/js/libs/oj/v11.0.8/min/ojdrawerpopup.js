/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","ojs/ojvcomponent","preact","jquery","ojs/ojanimation","ojs/ojcore-base","ojs/ojpopup","ojs/ojdrawerutils","hammerjs"],function(e,t,s,r,o,n,i,a,l){"use strict";r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,l=l&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l;var p=function(e,t,s,r){var o,n=arguments.length,i=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,s,i):o(t,s))||i);return n>3&&i&&Object.defineProperty(t,s,i),i};const c=oj.PopupService,d=window;e.DrawerPopup=class extends s.Component{constructor(){super(...arguments),this.state={opened:this.props.opened,selfClosed:!1},this.rootRef=s.createRef(),this.isShiftKeyActive=!1,this.handleKeyDown=e=>{if(e.key===a.DrawerConstants.keys.ESC)return void this.selfClose();const t=this.getFocusables();if(e.key===a.DrawerConstants.keys.TAB&&"modal"===this.props.modality){this.isShiftKeyActive=e.shiftKey;const{length:s,0:r,[s-1]:o}=t;if(!s)return e.preventDefault(),void this.rootRef.current.focus();if(e.shiftKey){if(document.activeElement===r)return e.preventDefault(),void o.focus()}else if(document.activeElement===o)return e.preventDefault(),void r.focus()}},this.autoDismissHandler=e=>{const t=this.getFocusables(),s=this.rootRef.current.parentNode;if("focus-loss"===this.props.autoDismiss){const r=this.isTargetDescendantOfOwnZorderLayerOrItsNextSiblings(s,e.target);if("focus"===e.type&&"modal"===this.props.modality&&!r){e.preventDefault();const s=e.relatedTarget,r=t[0],o=t[t.length-1];return void(s===r?o.focus():r.focus())}r||this.selfClose()}},this.getFocusables=()=>this.rootRef.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"]), video'),this.isTargetDescendantOfOwnZorderLayerOrItsNextSiblings=(e,t)=>{const s=[e];let r=e.nextSibling;for(;r;)s.push(r),r=r.nextSibling;return s.some(e=>e.contains(t))},this.handleSwipeAction=()=>{this.selfClose()}}render(e){return s.h(t.Root,{ref:this.rootRef,class:this.getPopupStyleClasses(this.props.edge),tabIndex:-1,role:this.props.role||"dialog",onKeyDown:this.handleKeyDown},e.children)}selfClose(){var e,t;const s={opened:!1,selfClosed:!0};this.setState(s),null===(t=(e=this.props).onOpenedChanged)||void 0===t||t.call(e,!1)}renderDrawer(e){const t=this.props.edge,s=r(this.rootRef.current),o={},n=c.OPTION;o[n.POPUP]=s,o[n.LAUNCHER]=r(document.activeElement),o[n.MODALITY]=this.props.modality,o[n.LAYER_SELECTORS]=this.getDrawerSurrogateLayerSelectors(),o[n.POSITION]=this.getDrawerPosition(t);const i=c.EVENT;o[n.EVENTS]={[i.POPUP_BEFORE_OPEN]:()=>this.beforeOpenHandler(t,o),[i.POPUP_AFTER_OPEN]:()=>this.handleFocus(e),[i.POPUP_BEFORE_CLOSE]:()=>this.beforeCloseHandler(t),[i.POPUP_AUTODISMISS]:e=>this.autoDismissHandler(e),[i.POPUP_REFRESH]:()=>{s.position(this.getDrawerPosition(t))}};const a=c.getInstance();this.isDrawerOpened()?a.open(o):a.close(o)}beforeOpenHandler(e,t){const s=t[c.OPTION.POPUP],r=t[c.OPTION.POSITION];return[a.DrawerConstants.stringStart,a.DrawerConstants.stringEnd].indexOf(e)>-1&&(this.rootRef.current.style.height=window.innerHeight+"px"),a.DrawerConstants.stringBottom===e&&(this.rootRef.current.style.width=document.documentElement.clientWidth+"px"),s.show(),s.position(r),o.slideIn(this.rootRef.current,a.DrawerUtils.getAnimationOptions(a.DrawerConstants.stringOpen,e))}beforeCloseHandler(e){return o.slideOut(this.rootRef.current,a.DrawerUtils.getAnimationOptions(a.DrawerConstants.stringClose,e))}getDrawerSurrogateLayerSelectors(){let e=a.DrawerConstants.DrawerPopupStyleSurrogate;return"modal"===this.props.modality&&(e+=` ${a.DrawerConstants.stringOjDrawer}${a.DrawerConstants.charDash}modal`),e}getDrawerPosition(e){let t=`${e} ${"bottom"===e?"bottom":"top"}`,s={my:t,at:t,of:window,collision:"none"};return oj.PositionUtils.normalizeHorizontalAlignment(s,a.DrawerUtils.isRTL())}isDrawerOpened(){return this.state.opened}getPopupStyleClasses(e){return a.DrawerUtils.getStyleClassesMapAsString(Object.assign({},a.DrawerUtils.getCommonStyleClasses(e,this.isDrawerOpened())))}static getDerivedStateFromProps(e,t){const s={};return!1===t.selfClosed&&e.opened!==t.opened&&(s.opened=e.opened),!1===t.opened&&(s.selfClosed=!1),s}handleFocus(e){const t=this.getFocusables();if(this.state.opened&&e.opened!==this.state.opened){const e=this.rootRef.current.querySelectorAll("[autofocus]"),{length:s,0:r}=e;if(s>0)return void r.focus();const{length:o,0:n}=t;(o>0?n:this.rootRef.current).focus()}}componentDidUpdate(e,t){this.renderDrawer(t),this.isDrawerOpened()&&"swipe"===this.props.closeGesture&&this.registerCloseWithSwipeListener(),!1===this.isDrawerOpened()&&t.opened&&this.unregisterCloseWithSwipeListener()}registerCloseWithSwipeListener(){this.hammerInstance=new l(d),this.props.edge===a.DrawerConstants.stringBottom&&this.hammerInstance.get("swipe").set({direction:l.DIRECTION_DOWN}),this.hammerInstance.on(this.getSwipeCloseDirection(this.props.edge),this.handleSwipeAction)}getSwipeCloseDirection(e){switch(e){case a.DrawerConstants.stringStart:return a.DrawerUtils.isRTL()?"swiperight":"swipeleft";case a.DrawerConstants.stringEnd:return a.DrawerUtils.isRTL()?"swipeleft":"swiperight";case a.DrawerConstants.stringBottom:return"swipedown"}}unregisterCloseWithSwipeListener(){this.hammerInstance&&this.hammerInstance.off(this.getSwipeCloseDirection(this.props.edge),this.handleSwipeAction)}},e.DrawerPopup.defaultProps={autoDismiss:"focus-loss",edge:"start",modality:"modal",opened:!1,closeGesture:"swipe"},e.DrawerPopup.metadata={slots:{"":{}},properties:{opened:{type:"boolean",writeback:!0},edge:{type:"string",enumValues:["start","end","bottom"]},modality:{type:"string",enumValues:["modal","modeless"]},autoDismiss:{type:"string",enumValues:["focus-loss","none"]},closeGesture:{type:"string",enumValues:["swipe","none"]}},extension:{_WRITEBACK_PROPS:["opened"],_READ_ONLY_PROPS:[],_OBSERVED_GLOBAL_PROPS:["role"]}},e.DrawerPopup=p([t.customElement("oj-drawer-popup")],e.DrawerPopup),Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ojdrawerpopup.js.map