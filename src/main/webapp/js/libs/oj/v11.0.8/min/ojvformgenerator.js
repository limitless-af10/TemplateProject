/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","preact","ojs/ojthemeutils","ojs/ojlabel","ojs/ojcustomelement-utils","ojs/ojdomutils"],function(t,e,l,o,s,n){"use strict";function a(t){const o=function(t,e){let o=t;if(e>1){const s=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/,n=t.match(s),a=parseFloat(n[1]);switch(n[2]){case"vw":case"vmin":case"vmax":case"%":if(e>1){let s=l.parseJSONFromFontFamily("oj-form-layout-option-defaults").columnGap;o="calc((("+t+" / "+e+") - (("+s+" * ("+(e-1)+") * "+a/e/100+")))"}}}return o}(t.labelWidth,t.colspan),s="calc(100% - "+o+")",n={flexGrow:"0",flexShrink:"0",flexBasis:o,width:o,maxWidth:o},a={flexGrow:"1",flexShrink:"1",flexBasis:s,width:s,maxWidth:s};return Array.isArray(t.children)||(t.children.props["label-edge"]="provided"),e.h(e.Fragment,null,e.h("div",{class:"oj-formlayout-inline-label",style:n},e.h("oj-label",{for:t.forid},t.labelText)),e.h("div",{class:"oj-formlayout-inline-value",style:a},t.children))}function r(t){return Array.isArray(t.children)||(t.children.props["label-edge"]="provided"),e.h(e.Fragment,null,e.h("oj-label",{for:t.forid},t.labelText),t.children)}function i(t){let l;if(t.children){const o=!Array.isArray(t.children);return o&&(l=s.ElementUtils.getUniqueId(t.children.props.id)),"start"===t.labelEdge?e.h(a,Object.assign({forid:l},t)):"top"===t.labelEdge?e.h(r,Object.assign({forid:l},t)):(o&&("inside"===t.labelEdge?(t.children.props["label-edge"]=t.labelEdge,t.children.props["label-hint"]=t.labelText):t.children.props["label-edge"]="none"),e.h(e.Fragment,null,t.children))}return null}class c extends e.Component{render(t){let l="oj-flex-item";const o=this._getFullFlexItemWidth(this.props.colspan,this.props.totalColumns);let s={flexGrow:"1",flexShrink:"1",flexBasis:o,width:o,maxWidth:o};return"start"==this.props.labelEdge&&(s.display="flex"),"formLayout"===this.props.contentType&&(l+=" oj-formlayout-nested-formlayout"),e.h("div",{class:l,style:s,key:t.cellKey},e.h(i,{labelText:this.props.labelText,labelEdge:this.props.labelEdge,labelWidth:this.props.labelWidth,colspan:this.props.colspan,totalColumns:this.props.totalColumns},this.props.children))}_getFullFlexItemWidth(t,e){if(t===e)return"100%";let o=(l.parseJSONFromFontFamily("oj-form-layout-option-defaults")||{}).columnGap,s=(this.props.totalColumns,"calc(((100% / "+e+") - (("+o+" * ("+(e-1)+") / "+e+")))");return t>1&&(s+=" * "+t+" + ("+o+" * "+(t-1)+")"),s+=")",s}}c.defaultProps={colspan:1,totalColumns:1,labelEdge:"inside",labelWidth:"33%",labelText:""};class u extends e.Component{render(t){this._columns=t.columns>0?t.columns:t.maxColumns;const l="oj-form-layout oj-formlayout-max-cols-"+this._columns,o=this._getColumnFormContent(t.formControls,t.columns);return e.h("div",{class:l},o)}_getColumnFormContent(t,o){let s,n,a,r=[];for(const o of t)n="function"==typeof o.content?o.content():o.content,a=o.labelEdge,a||(this._themeDefault||(this._themeDefault=l.parseJSONFromFontFamily("oj-form-layout-option-defaults")||{}),a=this._themeDefault.labelEdge),s=e.h(c,{totalColumns:1,labelText:o.labelText,labelEdge:a,labelWidth:o.labelWidth,contentType:o.contentType,cellKey:o.key},n),r.push(e.h("div",{class:"oj-flex","data-oj-internal":!0},s));const i=this._getColumnStyling(o);return e.h("div",{class:i.formClassName,style:i.formStyle,"data-oj-context":!0,"data-oj-internal":!0},r)}_getColumnStyling(t){let e="oj-form";return this.props.readonly||(e+=" oj-enabled"),"efficient"===this.props.userAssistanceDensity&&(e+=" oj-efficient"),"truncate"===this.props.labelWrapping&&(e+=" oj-formlayout-labels-nowrap"),t>0&&(e+=" oj-form-layout-no-min-column-width"),e+=" oj-form-cols",{formClassName:e,formStyle:{columnCount:this._columns,webkitColumnCount:this._columns,MozColumnCount:this._columns}}}}u.defaultProps={colspanWrap:"nowrap",formControls:[],labelWrapping:"wrap",columns:0,maxColumns:1,readonly:!1,userAssistanceDensity:"efficient"};class m extends e.Component{constructor(){super(...arguments),this.formDivRef=e.createRef(),this._resizeListener=this._resizeHandler.bind(this),this.state={availableColumns:0}}render(t){const l="oj-form-layout oj-formlayout-max-cols-"+(t.columns>0?t.columns+" oj-form-layout-no-min-column-width":t.maxColumns),o=this._getRowFormContent(this.props.formControls);return e.h("div",{class:l,ref:this.formDivRef},o)}componentDidMount(){0===this._calculateColumns(0)&&this.setState({availableColumns:this._calculateAvailableColumns(this.formDivRef.current)}),n.addResizeListener(this.formDivRef.current,this._resizeListener,25)}componentDidUpdate(){if(0===this.state.availableColumns&&0===this._calculateColumns(0)){const t=this.formDivRef.current,e=t.class;t.class="oj-form-layout";const l=this._calculateAvailableColumns(t);t.class=e,this.setState({availableColumns:l})}}componentWillUnmount(){n.removeResizeListener(this.formDivRef.current,this._resizeListener)}_resizeHandler(){if(this._calculateColumns(0)>0)this.state.availableColumns>0&&this.setState({availableColumns:0});else{const t=this.formDivRef.current,e=t.class;t.class="oj-form-layout";const l=this._calculateAvailableColumns(t);t.class=e,this.state.availableColumns!==l&&this.setState({availableColumns:l})}}_calculateAvailableColumns(t){let e=Math.max(this.props.maxColumns,1),l=parseFloat(window.getComputedStyle(t.querySelector(".oj-form")).columnWidth);if(!isNaN(l)){let t=this.formDivRef.current.getBoundingClientRect().width;e=Math.max(Math.floor(t/l),1)}return e}_calculateColumns(t){let e=Math.max(this.props.maxColumns,1);const l=this.props.columns;return l>0?e=l:e>1&&t<e&&(e=t),e}_getRowFormContent(t){let o,s=[];const n=this._calculateColumns(this.state.availableColumns);0===n&&(t=[]);let a,r,i,u,m=0,h=!1;for(const d of t){if(a=1,r=n,i="function"==typeof d.content?d.content():d.content,m%n==0&&(o&&this._addRowToForm(s,o,m),o=[]),d.colspan&&d.colspan>1){const t=m%n;let e=n-t;a=Math.floor(d.colspan),"wrap"===this.props.colspanWrap&&e<a&&t>0&&(this._addRowToForm(s,o,m),m+=e,o=[],e=n),a=Math.min(a,e),h=n>1}u=d.labelEdge,u||(this._themeDefault||(this._themeDefault=l.parseJSONFromFontFamily("oj-form-layout-option-defaults")||{}),u=this._themeDefault.labelEdge),o.push(e.h(c,{colspan:a,totalColumns:r,labelText:d.labelText,labelEdge:u,labelWidth:d.labelWidth,contentType:d.contentType,cellKey:d.key},i)),m+=a,m%n!=0&&this._addColumnGutter(o)}this._addRowToForm(s,o,m);const d=this._getRowStyling(h);return e.h("div",{class:d.formClassName,style:d.formStyle,"data-oj-context":!0,"data-oj-internal":!0},s)}_addColumnGutter(t){t.push(e.h("div",{class:"oj-formlayout-column-gutter"}))}_addRowToForm(t,l,o){this._addPaddingCells(l,o),t.push(e.h("div",{class:"oj-flex","data-oj-internal":!0},l))}_addPaddingCells(t,l){const o=this._calculateColumns(this.state.availableColumns)||this.props.maxColumns,s=l%o;if(t&&s>0)for(let l=s;l<o;l++)l!==s&&this._addColumnGutter(t),t.push(e.h(c,{colspan:1,totalColumns:o,labelEdge:"none"}))}_getRowStyling(t){let e="oj-form";this.props.readonly||(e+=" oj-enabled"),"efficient"===this.props.userAssistanceDensity&&(e+=" oj-efficient"),"truncate"===this.props.labelWrapping&&(e+=" oj-formlayout-labels-nowrap"),t&&(e+=" oj-form-control-full-width"),e+=" oj-form-cols";return e+=" oj-formlayout-form-across",{formClassName:e,formStyle:{columnCount:1,webkitColumnCount:1,MozColumnCount:1}}}}m.defaultProps={colspanWrap:"nowrap",formControls:[],labelWrapping:"wrap",columns:0,maxColumns:1,readonly:!1,userAssistanceDensity:"efficient"};var h=function(t,e){var l={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(l[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(t);s<o.length;s++)e.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(t,o[s])&&(l[o[s]]=t[o[s]])}return l};class d extends e.Component{render(t){const{direction:l}=t,o=h(t,["direction"]);return"column"===l?e.h(u,Object.assign({},o)):e.h(m,Object.assign({},o))}}d.defaultProps={colspanWrap:"nowrap",direction:"row",formControls:[],labelWrapping:"wrap",columns:0,maxColumns:1,readonly:!1,userAssistanceDensity:"efficient"},t.VFormGenerator=d,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ojvformgenerator.js.map